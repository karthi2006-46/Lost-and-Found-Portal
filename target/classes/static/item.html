<!DOCTYPE html>
<html>
<head>
<title>Item Details</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

</head>

<body class="bg-light">

<nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow">
<div class="container">

<a class="navbar-brand fw-bold">Lost & Found Portal</a>

<div class="ms-auto d-flex align-items-center gap-2">

  <a href="/" class="btn btn-light btn-sm rounded-pill px-3">
    <i class="fa fa-home me-1"></i> Home
  </a>

  <a href="/my-claims.html" class="btn btn-warning btn-sm rounded-pill px-3">
    <i class="fa fa-list me-1"></i> My Claims
  </a>

  <span class="badge bg-light text-dark rounded-pill px-3 py-2">
    <i class="fa fa-user-circle me-1"></i>
    <span id="user"></span>
  </span>

  <button onclick="logout()" class="btn btn-danger btn-sm rounded-pill px-3">
    <i class="fa fa-sign-out-alt me-1"></i> Logout
  </button>

</div>
</div>
</nav>



<div class="container mt-4">
<div class="card shadow-lg p-4">
<div class="row align-items-center">

  <!-- LEFT IMAGE -->
  <div class="col-md-5 text-center">
    <img id="img" class="img-fluid rounded border" style="max-height:350px">
  </div>

  <!-- RIGHT DETAILS -->
  <div class="col-md-7">
    <h3 id="title"></h3>
    <p id="desc"></p>

    <p><b>Location:</b> <span id="loc"></span></p>
    <p><b>Category:</b> <span id="cat"></span></p>
    <p><b>Status:</b> <span id="status"></span></p>
    <p><b>Date:</b> <span id="date"></span></p>
   <p><b>Mobile:</b> <span id="mobile"></span></p>


    <div id="claimArea"></div>
  </div>

</div>
</div>
</div>

<script>
/* =====================
   LOGIN CHECK (STRICT)
   ===================== */
const token = localStorage.getItem("token");
const user  = localStorage.getItem("username");

if (!token) {
  alert("Please login to view item details");
  window.location = "/login.html";
}

/* =====================
   GET ITEM ID
   ===================== */
const params = new URLSearchParams(window.location.search);
const id = params.get("id");

if (!id) {
  alert("Invalid item");
  window.location = "/";
}

/* =====================
   LOAD ITEM DETAILS
   ===================== */
fetch("/api/items/" + id)
  .then(res => {
    if (!res.ok) throw new Error("Item not found");
    return res.json();
  })
  .then(i => {
    title.innerText   = i.title;
    desc.innerText    = i.description ?? "";
    loc.innerText     = i.location ?? "-";
    cat.innerText     = i.category ?? "-";
    status.innerText  = i.status;
    date.innerText    = i.dateEvent;
    mobile.innerText  = i.mobile;

    if (i.photo) {
      img.src = "/api/items/photo/" + i.id;
    } else {
      img.style.display = "none";
    }

    // Claim logic
    if (!i.lost) {
      claimArea.innerHTML = `
        <button onclick="claimItem(${i.id})" class="btn btn-warning w-100">
          Claim Item
        </button>`;
    } else {
      claimArea.innerHTML =
        `<small class="text-muted">Waiting for finder...</small>`;
    }

    document.getElementById("user").innerText = user;
  })
  // .catch(err => {
  //   alert("Unable to load item details");
  //   console.error(err);
  //   window.location = "/";
  // });

/* =====================
   CLAIM ITEM
   ===================== */
async function claimItem(id){
  let reason = prompt("Enter claim reason:");
  if (!reason) return;

  let res = await fetch("/api/claims/" + id + "?reason=" + reason, {
    method: "POST",
    headers: {
      "Authorization": "Bearer " + token
    }
  });

  if (!res.ok) {
    alert("Claim failed");
    return;
  }

  alert("Claim submitted successfully");
}

/* =====================
   LOGOUT
   ===================== */
function logout(){
  localStorage.clear();
  window.location = "/login.html";
}
</script>


</body>
</html>
